<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyperHDG: /home/runner/work/HyperHDG/HyperHDG/include/HyperHDG/sparse_la.hxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HyperHDG
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_050d731321a94042e4b3e8b4bd1111dc.html">HyperHDG</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sparse_la.hxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sparse__la_8hxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#pragma once  // Ensure that file is included only once in a single compilation.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="hy__assert_8hxx.html">HyperHDG/hy_assert.hxx</a>&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// #include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// #include &lt;exception&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * \brief   A namespace containing different functions that implement basic linear algebra</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *          operations using large vectors.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * This namespace provides several functions to implement basic linear algebra operations of (long)</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * vector type in combination with a class providing a function \c matrix_vector_multiply. This</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * is mainly used for C++ examples and test cases that do not use the Python interface and its</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * version of an CG method, for example.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="namespaceSparseLA.html">   20</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceSparseLA.html">SparseLA</a></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \brief   Exception to be thrown if conjugate gradient fails.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2019.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2019.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="structSparseLA_1_1SolveException.html">   28</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structSparseLA_1_1SolveException.html">SolveException</a> : <span class="keyword">public</span> <a class="code" href="License_8txt.html#ad8404db5e23841dcb367ab565ba9dfd6">std::exception</a></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="structSparseLA_1_1SolveException.html#a5cf659d35cfaf55821fb4108ebc61626">   30</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="structSparseLA_1_1SolveException.html#a5cf659d35cfaf55821fb4108ebc61626">what</a>() <span class="keyword">const</span> throw() { <span class="keywordflow">return</span> <span class="stringliteral">&quot;The sparse CG method did not converge.&quot;</span>; }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;};</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * \brief   Evaluate the inner product of two vectors.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * Naive implementation of an Euclidean inner product of two large vectors which are supposed to be</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * of the same size. This function is needed to calculate a vector&#39;s 2 norm or to implement a CG</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * scheme.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * \tparam  vectorT             The class name of the large vector.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * \param   left                Left argument of the inner product.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * \param   right               Right argument of the inner product.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * \retval  product             Inner product of the two arguments.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> vectorT&gt;</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">   48</a></span>&#160;<span class="keyword">typename</span> vectorT::value_type <a class="code" href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">inner_product</a>(<span class="keyword">const</span> vectorT&amp; left, <span class="keyword">const</span> vectorT&amp; right)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <a class="code" href="hy__assert_8hxx.html#abd967d8057f24212ed0d485711ce001b">hy_assert</a>(left.size() == right.size(), <span class="stringliteral">&quot;Both vectors of inner product must be of same size!&quot;</span>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">typename</span> vectorT::value_type product = 0.;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">for</span> (decltype(left.size()) i = 0; i &lt; left.size(); ++i)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    product += left[i] * right[i];</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">return</span> product;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * \brief   Evaluate 2 norm of a vector.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> * Naive implementation of an 2 norm of a vector. This is the square root of the \c inner_product of</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> * a vector paired with itself.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> * \tparam  vectorT             The class name of the large vector.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> * \param   vec                 Vector whose 2 norm is to be calculates.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> * \retval  norm                2 norm of given vector.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> vectorT&gt;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="namespaceSparseLA.html#a788c76015ce89d355f10975827f5db0f">   71</a></span>&#160;<span class="keyword">typename</span> vectorT::value_type <a class="code" href="namespaceSparseLA.html#a788c76015ce89d355f10975827f5db0f">norm_2</a>(<span class="keyword">const</span> vectorT&amp; vec)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">return</span> std::sqrt(<a class="code" href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">inner_product</a>(vec, vec));</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"> * \brief   Evaluate linear combination of vectors and return the result.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> * This functions takes two large vectors and two floating points, and returns their linear</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> * combination &quot;leftFac * leftVec + rightFac * rightVec&quot; as a new vector (in contrast to just a</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> * reference to a vector).</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> * \tparam  vectorT             The class name of the large vector.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> * \param   leftFac             Scaling factor of left vector.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> * \param   leftVec             Left vector in linear combination.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * \param   rightFac            Scaling factor of right vector.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> * \param   rightVec            Right vector in linear combination.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> * \retval  lin_comb            Linear combination of vectors with respective coefficients.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> vectorT&gt;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">   93</a></span>&#160;vectorT <a class="code" href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">linear_combination</a>(<span class="keyword">const</span> <span class="keyword">typename</span> vectorT::value_type leftFac,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                           <span class="keyword">const</span> vectorT&amp; leftVec,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                           <span class="keyword">const</span> <span class="keyword">typename</span> vectorT::value_type rightFac,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                           <span class="keyword">const</span> vectorT&amp; rightVec)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="hy__assert_8hxx.html#abd967d8057f24212ed0d485711ce001b">hy_assert</a>(leftVec.size() == rightVec.size(), <span class="stringliteral">&quot;Linear combined vectors must be of same size!&quot;</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  vectorT lin_comb(leftVec.size(), 0.);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">for</span> (decltype(leftVec.size()) i = 0; i &lt; leftVec.size(); ++i)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    lin_comb[i] = leftFac * leftVec[i] + rightFac * rightVec[i];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">return</span> lin_comb;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> * \brief   Evaluate linear combination of vectors and return reference to result.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * This functions takes two large vectors and two floating points, and returns their linear</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> * combination &quot;leftFac * leftVec + rightFac * rightVec&quot; as a reference to a vector. This vector</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> * needs to be passed to the function</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> * \tparam  vectorT             The class name of the large vector.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> * \param   leftFac             Scaling factor of left vector.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> * \param   leftV               Left vector in linear combination.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> * \param   rightFac            Scaling factor of right vector.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"> * \param   rightV              Right vector in linear combination.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> * \param   result              Reference to vector whicb is supposed to contain the result.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> * \retval  result              Linear combination of vectors with respective coefficients.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> vectorT&gt;</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="namespaceSparseLA.html#ac3900cc49b83ca4bc70795ef3e9f06eb">  124</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">linear_combination</a>(<span class="keyword">const</span> <span class="keyword">typename</span> vectorT::value_type leftFac,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        <span class="keyword">const</span> vectorT&amp; leftV,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="keyword">const</span> <span class="keyword">typename</span> vectorT::value_type rightFac,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        <span class="keyword">const</span> vectorT&amp; rightV,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        vectorT&amp; result)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="hy__assert_8hxx.html#abd967d8057f24212ed0d485711ce001b">hy_assert</a>(leftV.size() == rightV.size() &amp;&amp; leftV.size() == result.size(),</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="stringliteral">&quot;All three vectors of linear combination must be of same size!&quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span> (decltype(leftV.size()) i = 0; i &lt; result.size(); ++i)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    result[i] = leftFac * leftV[i] + rightFac * rightV[i];</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/*!*************************************************************************************************</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> * \brief   Execute conjugate gradient algorithm to find solution to system of equations.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> * Execute conjugate gradient algorithm where the matrix is not explicitly given, but the template</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> * class \c ProblemT is supposed to implement a function \c matrix_vector_multiply which only takes</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> * a \c large vector and generates the matrix vector product from that. The associated matrix is</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> * assumed to be square and symmetric positive definite.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"> * \tparam  ProblemT            Class to implement matrix vector multiplication.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> * \tparam  vectorT             The class name of the large vector.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"> * \param   b                   Right-hand side of linear system of equations.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"> * \param   problem             Class instantiation to implement matrix vector multiplication.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> * \param   n_iterations        Maximum number of iterations. 0 is default and the size of b.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"> * \param   tolerance           Absolute tolerance value in 2 norm. Default is 1e-9.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"> * \retval  solution            Vector sufficing Ax = b up to given tolerance if converged.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"> * \retval  n_iterations        Number of needed iterations. -1 indicates no convergence.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> * \authors   Guido Kanschat, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> * \authors   Andreas Rupp, Heidelberg University, 2020.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> **************************************************************************************************/</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> ProblemT, <span class="keyword">typename</span> vectorT&gt;</div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="namespaceSparseLA.html#a26d566fc52e9d2b724dae03bf7c3f971">  157</a></span>&#160;vectorT <a class="code" href="namespaceSparseLA.html#a26d566fc52e9d2b724dae03bf7c3f971">conjugate_gradient</a>(<span class="keyword">const</span> vectorT&amp; b,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                           ProblemT&amp; problem,</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_iterations = 0,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                           <span class="keyword">const</span> <span class="keyword">typename</span> vectorT::value_type <a class="code" href="namespacediffusion__uniform.html#af067c16e23f0f7819927ce9134db00b8">tolerance</a> = 1e-9)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  vectorT x(b.size(), (<span class="keyword">typename</span> vectorT::value_type)0.);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  vectorT r = b;  <span class="comment">// b - A * x (with x = 0)</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  vectorT d = r;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">typename</span> vectorT::value_type r_square_new = <a class="code" href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">inner_product</a>(r, r);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keyword">typename</span> vectorT::value_type r_square_old = r_square_new;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">if</span> (r_square_new &lt; <a class="code" href="namespacediffusion__uniform.html#af067c16e23f0f7819927ce9134db00b8">tolerance</a> * <a class="code" href="namespacediffusion__uniform.html#af067c16e23f0f7819927ce9134db00b8">tolerance</a>)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    n_iterations = 0;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">return</span> x;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">if</span> (n_iterations == 0)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    n_iterations = b.size();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="hy__assert_8hxx.html#abd967d8057f24212ed0d485711ce001b">hy_assert</a>(n_iterations &gt; 0, <span class="stringliteral">&quot;Number of allowed iterations of CG solver must be positive.&quot;</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_iterations; ++k)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    vectorT z = problem.trace_to_flux(d);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    r_square_old = r_square_new;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">typename</span> vectorT::value_type alpha = r_square_old / <a class="code" href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">inner_product</a>(d, z);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">linear_combination</a>((<span class="keyword">typename</span> vectorT::value_type)1., x, alpha, d, x);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">linear_combination</a>((<span class="keyword">typename</span> vectorT::value_type)1., r, -alpha, z, r);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    r_square_new = <a class="code" href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">inner_product</a>(r, r);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">typename</span> vectorT::value_type beta = r_square_new / r_square_old;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">linear_combination</a>((<span class="keyword">typename</span> vectorT::value_type)1., r, beta, d, d);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (r_square_new &lt; <a class="code" href="namespacediffusion__uniform.html#af067c16e23f0f7819927ce9134db00b8">tolerance</a> * <a class="code" href="namespacediffusion__uniform.html#af067c16e23f0f7819927ce9134db00b8">tolerance</a>)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      n_iterations = k + 1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">return</span> x;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">throw</span> <a class="code" href="structSparseLA_1_1SolveException.html">SparseLA::SolveException</a>();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">return</span> x;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}  <span class="comment">// end of namespace SparseLA</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="ahy__assert_8hxx_html"><div class="ttname"><a href="hy__assert_8hxx.html">hy_assert.hxx</a></div><div class="ttdoc">This file provides the function hy_assert.</div></div>
<div class="ttc" id="anamespaceSparseLA_html_a26d566fc52e9d2b724dae03bf7c3f971"><div class="ttname"><a href="namespaceSparseLA.html#a26d566fc52e9d2b724dae03bf7c3f971">SparseLA::conjugate_gradient</a></div><div class="ttdeci">vectorT conjugate_gradient(const vectorT &amp;b, ProblemT &amp;problem, unsigned int n_iterations=0, const typename vectorT::value_type tolerance=1e-9)</div><div class="ttdoc">Execute conjugate gradient algorithm to find solution to system of equations.</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:157</div></div>
<div class="ttc" id="anamespaceSparseLA_html"><div class="ttname"><a href="namespaceSparseLA.html">SparseLA</a></div><div class="ttdoc">A namespace containing different functions that implement basic linear algebra operations using large...</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:20</div></div>
<div class="ttc" id="aLicense_8txt_html_ad8404db5e23841dcb367ab565ba9dfd6"><div class="ttname"><a href="License_8txt.html#ad8404db5e23841dcb367ab565ba9dfd6">exception</a></div><div class="ttdeci">if the work is an executable linked with the with the complete machine readable work that uses the as object code and or source so that the user can modify the Library and then relink to produce a modified executable containing the modified rather than copying library functions into the if the user installs as long as the modified version is interface compatible with the version that the work was made with c Accompany the work with a written valid for at least three to give the same user the materials specified in for a charge no more than the cost of performing this distribution d If distribution of the work is made by offering access to copy from a designated offer equivalent access to copy the above specified materials from the same place e Verify that the user has already received a copy of these materials or that you have already sent this user a copy For an the required form of the work that uses the Library must include any data and utility programs needed for reproducing the executable from it as a special exception</div><div class="ttdef"><b>Definition:</b> License.txt:320</div></div>
<div class="ttc" id="anamespaceSparseLA_html_a788c76015ce89d355f10975827f5db0f"><div class="ttname"><a href="namespaceSparseLA.html#a788c76015ce89d355f10975827f5db0f">SparseLA::norm_2</a></div><div class="ttdeci">vectorT::value_type norm_2(const vectorT &amp;vec)</div><div class="ttdoc">Evaluate 2 norm of a vector.</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:71</div></div>
<div class="ttc" id="astructSparseLA_1_1SolveException_html"><div class="ttname"><a href="structSparseLA_1_1SolveException.html">SparseLA::SolveException</a></div><div class="ttdoc">Exception to be thrown if conjugate gradient fails.</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:28</div></div>
<div class="ttc" id="anamespaceSparseLA_html_a4e8d2ccaece139868adfed54769bfca8"><div class="ttname"><a href="namespaceSparseLA.html#a4e8d2ccaece139868adfed54769bfca8">SparseLA::inner_product</a></div><div class="ttdeci">vectorT::value_type inner_product(const vectorT &amp;left, const vectorT &amp;right)</div><div class="ttdoc">Evaluate the inner product of two vectors.</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:48</div></div>
<div class="ttc" id="ahy__assert_8hxx_html_abd967d8057f24212ed0d485711ce001b"><div class="ttname"><a href="hy__assert_8hxx.html#abd967d8057f24212ed0d485711ce001b">hy_assert</a></div><div class="ttdeci">#define hy_assert(Expr, Msg)</div><div class="ttdoc">The assertion to be used within HyperHDG â€” deactivate using -DNDEBUG compile flag.</div><div class="ttdef"><b>Definition:</b> hy_assert.hxx:38</div></div>
<div class="ttc" id="anamespaceSparseLA_html_ac570d418f73cd49d70fd962be2e4e00b"><div class="ttname"><a href="namespaceSparseLA.html#ac570d418f73cd49d70fd962be2e4e00b">SparseLA::linear_combination</a></div><div class="ttdeci">vectorT linear_combination(const typename vectorT::value_type leftFac, const vectorT &amp;leftVec, const typename vectorT::value_type rightFac, const vectorT &amp;rightVec)</div><div class="ttdoc">Evaluate linear combination of vectors and return the result.</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:93</div></div>
<div class="ttc" id="anamespacediffusion__uniform_html_af067c16e23f0f7819927ce9134db00b8"><div class="ttname"><a href="namespacediffusion__uniform.html#af067c16e23f0f7819927ce9134db00b8">diffusion_uniform.tolerance</a></div><div class="ttdeci">int tolerance</div><div class="ttdef"><b>Definition:</b> diffusion_uniform.py:27</div></div>
<div class="ttc" id="astructSparseLA_1_1SolveException_html_a5cf659d35cfaf55821fb4108ebc61626"><div class="ttname"><a href="structSparseLA_1_1SolveException.html#a5cf659d35cfaf55821fb4108ebc61626">SparseLA::SolveException::what</a></div><div class="ttdeci">const char * what() const</div><div class="ttdef"><b>Definition:</b> sparse_la.hxx:30</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
